YUI.add("fluid-share-view",function(e,r){var t=require("hermes-core/flog")(r),a={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{twitter:{canShare:!1,className:"twitter-link",serviceId:9},facebook:{canShare:!1,className:"facebook-link",serviceId:128},tumblr:{canShare:!1,className:"tumblr-link",serviceId:12},pinterest:{canShare:!1,className:"pinterest-link",serviceId:132},flickr:{canShare:!1,className:"flickr-link",serviceId:130}}}};a.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(a.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:"#flickr"},tumblr:{shareUrl:"https://www.tumblr.com/widgets/share/tool?caption={{tumblrCaption}}&tags={{tags}}&url={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},googlePlus:{shareUrl:"https://plus.google.com/share?url="},flickr:{apiCall:"flickr.sharing.post"}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.extraModalClasses=this.extraModalClasses||"","en-us"===this.appContext.lang.toLowerCase()?this.isEnglishLang=!0:this.isEnglishLang=!1,this.errorTitle=this.intlMessage({intlName:"common.OOPS"}),this.errorMessage=this.intlMessage({intlName:"share-modal.NO_SHAREABLE_ITEMS"}),this.removeOverlayOnClose=e.removeOverlayOnClose,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerWithTemplate("fluid-share",e),this},activate:function(){var r=this.get("container"),t="."+a.css.shareBtn,s=r.one(t);return!s||!this.isEnglish&&this.isDisabled||this.registerEventHandler(r.delegate(["click","keydown"],function(r){"click"!==r.type&&13!==r.keyCode||(r.preventDefault(),e.rapidTracker.beacon(this.subClassName,"shareButtonClick"),this.getItemCount().then(function(r){e.rapidTracker.beacon(this.subClassName,"shareButtonClickCount",{count:r})}.bind(this)),this.prepareModal(s))},t,this)),this},prepareModal:function(r){if(!this.shouldCancelModal())return this.getItemCount().then(function(t){return this.isDisabled?e.Promise.resolve(this.showErrorModal()):e.Promise.resolve(this.showModal(r,t,this.removeOverlayOnClose))}.bind(this)).catch(function(e){t.error({err:e})})},showModal:function(r,t,s){var i,n=this,o=this.getIsMine(),l=a.css.networkClasses,c=n.getTitleIntlKey(),h={intlName:"share-modal."+c};return"SHARE_PHOTOS_TO"!==c&&"SHARE_VIDEO_TO"!==c||(h.count=t),(i=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,title:n.intlMessage(h),classList:"modal-restyle "+n.extraModalClasses,width:560,subview:new e.Views["fluid-share-panel-view"]({appContext:n.appContext,networkClasses:l,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters(),isMine:o,shareItemCount:t,signedOutSharingPerms:this.getSignedOutSharingPerms(),canVr:this.get("canVr")}),removeOverlayOnClose:s})).registerEventHandler(i.get("container").delegate(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||(e.preventDefault(),e.target.ancestor("."+l.facebook.className,!0)?n.preProcessShare(n.prepareFacebookShareParameters,n.shareToFacebook):e.target.ancestor("."+l.twitter.className,!0)?n.preProcessShare(n.prepareTwitterShareParameters,n.shareToTwitter):e.target.ancestor("."+l.tumblr.className,!0)?n.preProcessShare(n.prepareTumblrShareParameters,n.shareToTumblr):e.target.ancestor("."+l.pinterest.className,!0)&&n.preProcessShare(n.preparePinterestShareParameters,n.shareToPinterest))},".share-link.sharing-type-enabled")),i.on("share-by-email",function(r){var t=e.merge(n.prepareFlickrShareParameters(),r);n.shareToFlickr(i,t)}),i.on("done-sharing",function(r){i.close(),n.guestPassURLs={},e.rapidTracker.beacon(this.subClassName,"doneSharingClick")}),i.on("request-guestpass",function(e,r,t){n.requestGuestpass(i,r,t,!0)}),i.on("generate-link",function(){n.generateLink().then(function(e){i.fire("parentViewEvent","generated-link",e)})}),i.on("activated",function(){i.get("subview").cancel&&i.get("container").one(".title").setHTML(n.intlMessage({intlName:"common.OOPS"})),i.reposition()}),i.on("guestpass-required",function(){n.guestpassRequired=!0}),i.on("confirm-sign-in",function(){i.close();var r=new e.Views.FluidModal({appContext:n.appContext,title:n.intlMessage({intlName:"common.OOPS"}),message:n.intlMessage({intlName:"share-modal.SIGN_IN_TO_EMAIL"}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),classList:"sharing-sign-out-modal",showCancelButton:!0});r.on("actionClick",function(){e.StorageHelper.setItem("signedOutEmailSharing",new Date),e.SigninHelper.addPendingShare({shareType:"email"})}),setTimeout(function(){r.show()},10)}),i.on("close",function(){n.fire("sharePresentationClose"),n.guestPassURLs={},e.rapidTracker.beacon(n.name,"shareModalCancelClick")}),i.on("closeAll",function(){n.fire("sharePresentationClose"),i.close(),n.guestPassURLs={}}),i.show(),this.sharePresentation=i,i},showErrorModal:function(){var r=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,noScroll:!0,hideModalOverlay:!1,showFooter:!0,title:this.errorTitle,message:this.errorMessage});return r.show(),r},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareGooglePlusShareParameters:function(){return{url:"",count:1}},prepareFlickrShareParameters:function(){return{modelName:"",modelId:"",title:"",url:"",count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:"",generateLink:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return e.Promise.resolve(1)},getIsMine:function(){return!1},getGuestPassParams:function(){return{type:null,id:null,contentMarkedFriends:!0,contentMarkedFamily:!0,contentMarkedFriendFamily:!0,contentMarkedPublic:!0,canSharePrivate:!1,sharingEntirelyNotPublic:!1,multipleItems:!1,nonPublicWarning:null,shareToAll:!1,showGuestPassDropdown:!1,shareToSpecific:null}},getSignedOutSharingPerms:function(){return{facebook:{canShare:!0},twitter:{canShare:!0},tumblr:{canShare:!0},pinterest:{canShare:!0},flickr:{canShare:!1}}},shouldCancelModal:function(){return!1},shareToFacebook:function(r,s){if(!r.url)return t.error("Error sharing to Facebook.  Missing url.");var i,n,o,l,c,h=encodeURIComponent(e.url(r.url)),u=this.guestPassURLs;this.guestpassRequired&&u&&(n=u[100],o=u["010"],l=u[110],c=u[111],o&&(h=o),n&&(h=n),l&&(h=l),c&&(h=c)),i=a.networks.facebook.shareUrl+h,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i),this.trackShareCompletion(s)},shareToTwitter:function(r,s){if(void 0===r.url||null===r.url)return t.error("Error sharing to Twitter.  Missing url.");if(!r.title)return t.error("Error sharing to Twitter.  Missing title.");var i,n,o,l,c=r.title;n=""===r.url?"":encodeURIComponent(r.url),(l=c+" "+a.networks.twitter.hashTags).length+n.length>140&&(o=l.length+n.length-140,l=c.substring(0,c.length-(o+1))+"â€¦ "+a.networks.twitter.hashTags),i=a.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(l)).replace("{{linkToShare}}",n),s?s.location.replace(i):s=this.createSharePopup(i),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:r.count||1}),this.trackShareCompletion(s)},shareToTumblr:function(r,s){if(!r.title)return t.error("Error sharing to Tumblr.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Tumblr.  Missing displayPhotoURL.");var i,n,o,l,c,h=r.title,u=r.tags||"",p=r.description,d=e.URLHelper.addProtocolToURL(r.displayPhotoURL),g=r.isPhotoPage,m=a.networks.tumblr.shareUrl;g&&this.appContext.flipper.isFlipped("enable-tumblr-embed-share")||(m+="&shareSource=legacy&posttype=photo&content={{displayPhotoURL}}&clickthroughUrl={{linkToShare}}"),r.authorURL&&(n=e.url(r.authorURL)),r.ownerName&&(o=r.ownerName),l=0===r.url.indexOf("https://")?r.url:0===r.url.indexOf("//")?e.URLHelper.addProtocolToURL(r.url):e.url(r.url),i=this.templates("fluid-share-tumblr-post")({title:h,ownerURL:n,ownerName:o,description:p,linkToShare:l}),c=m.replace("{{displayPhotoURL}}",encodeURIComponent(d)).replace("{{tumblrCaption}}",encodeURIComponent(i)).replace(/{{linkToShare}}/g,encodeURIComponent(l)).replace("{{tags}}",encodeURIComponent(u)),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:r.count||1}),s?s.location.replace(c):s=this.createSharePopup(c,!0)},shareToPinterest:function(r,s){if(!r.title)return t.error("Error sharing to Pinterest.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Pinterest.  Missing displayPhotoURL.");if(!r.url)return t.error("Error sharing to Pinterest.  Missing url.");if(!r.shortURL)return t.error("Error sharing to Pinterest.  Missing shortURL.");var i,n,o,l=e.Handlebars.helpers.stripTags(r.description)||"",c=r.shortURL,h=r.title,u=e.URLHelper.addProtocolToURL(r.displayPhotoURL);n=encodeURIComponent(e.url(r.url)),o=""!==l.trim()?c+" | "+h+" | "+l:c+" | "+h,u=u.replace("https:","http:"),n=n.replace("https:","http:"),i=a.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(u)).replace("{{description}}",encodeURIComponent(o)).replace("{{linkToShare}}",n),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i,!0)},shareToGooglePlus:function(r,s){if(!r.url)return t.error("Error sharing to GooglePlus.  Missing url.");var i,n;n=encodeURIComponent(e.url(r.url)),i=a.networks.googlePlus.shareUrl+n,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"googlePlus",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i)},shareToFlickr:function(r,s){if(!s.recipients)return t.error("Error sharing to Flickr.  Missing recipients.");if(!s.url)return t.error("Error sharing to Flickr.  Missing url.");if(!s.modelName)return t.error("Error sharing to Flickr.  Missing modelName.");if(!s.modelId)return t.error("Error sharing to Flickr.  Missing modelId.");var i,n,o=s.modelName,l=s.modelId,c=s.recipients,h=s.message||"",u=s.guestpassStr||"public",p={},d=[],g=[];encodeURIComponent(e.url(s.url)),"share_code"===o?p[o]=l:p[o+"_id"]=l,p.service_type_id="130",p.owner_id=this.appContext.getViewer().nsid,"public"!==u&&("friends"!==u&&"family_and_friends"!==u||(p.guestpass_friends="1"),"family"!==u&&"family_and_friends"!==u||(p.guestpass_family="1"),"private"===u&&(p.guestpass_private="1",p.guestpass_friends="1",p.guestpass_family="1"));for(i in c)(n=c[i]||{}).email?d.push(n.email):n.nsid&&g.push(n.nsid);p.to_flickr=g.join(","),p.to_email=d.join(","),p.message=e.flutil.escapeInput(h),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:s.count||1,flkcnt:g.length,emailcnt:d.length});var m=e.StorageHelper.getItem("signedOutEmailSharing");if(m){var f;try{(f=e.moment(m)).isValid()&&(new e.moment).diff(f,"hours")<2&&(e.rapidTracker.beacon(this.get("parentViewName"),"signedOutEmailShare",{count:s.count||1}),e.StorageHelper.remove("signedOutEmailSharing"))}catch(e){}}if(!a.networks)throw new Error("Missing sharing api configuration.");this.appContext.callAPI(a.networks.flickr.apiCall,p).then(function(){r&&r.fire("parentViewEvent","flickr-share-success")},function(e){r&&r.fire("parentViewEvent","flickr-share-error")})},generateLink:function(){var r=this;return this.onBeforeShare().then(function(e){return e},function(t){r.sharePresentation.fire("closeAll"),setTimeout(function(){new e.Views.FluidModal({appContext:r.appContext,title:r.intlMessage({intlName:"common.OOPS"}),message:r.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:r.getGuestPassParams.multipleItems?10:1}),actionButtonLabel:r.intlMessage({intlName:"common.OK"}),classList:"sharing-failure-modal",showCancelButton:!1}).show()},10)})},preProcessShare:function(e,r){var a=this;if(this.onBeforeShare){var s=this.createSharePopup("",!0);try{s.document.body.innerHTML=a.templates("fluid-share-loading-state")()}catch(e){18===e.code&&(s.close(),(s=this.createSharePopup("",!0)).document.body.innerHTML=a.templates("fluid-share-loading-state")())}this.onBeforeShare().then(function(i){var n;try{n=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,n,s)})}else{var i;try{i=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,i)}},trackShareCompletion:function(r){var a=function(s){if(s.source===r)if(s.origin===e.url("/")&&"Window closed"===s.data)t.log("Closing Facebook window."),e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",a,!1);else if(s.origin===e.url("/")&&0===s.data.indexOf("share failure"))t.error("Got Facebook error",{data:s.data}),e.config.win.removeEventListener("message",a,!1);else if("https://twitter.com"===s.origin&&"__ready__"!==s.data)try{t.log("Tracking share completion",{data:s.data}),"tweet"===JSON.parse(s.data).params[0]&&s.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",a,!1))}catch(e){t.error("Error tracking share completion",{err:e})}};e.config.win.addEventListener("message",a,!1)},createSharePopup:function(r,t){var a={},s="",i="nativeShare"+(new Date).getTime();return a.width=t?950:640,a.height=480,a.top=(e.config.win.screen.height-a.height)/2,a.left=(e.config.win.screen.width-a.width)/2,e.Object.each(a,function(e,r){s+=r+"="+e+","}),s=s.slice(0,-1),e.config.win.open(r,i,s)},requestGuestpass:function(e,r,t,a){var s=this;this.guestPassURLs||(this.guestPassURLs={}),this.guestPassURLs[r]?e.fire("parentViewEvent","guestpass-created",r,this.guestPassURLs[r]):this.appContext.callAPI("flickr.sharing.createGuestpass",t).then(function(t){if(!t||!t.guestpass||!t.guestpass.url)throw new Error("No guestpass returned");s.guestPassURLs[r]=t.guestpass.url,e.fire("parentViewEvent","guestpass-created",r,s.guestPassURLs[r])},function(i){a?s.requestGuestpass(e,r,t):e.fire("parentViewEvent","guestpass-failed",i)})}},{ATTRS:{parentViewName:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","hermes-template-fluid-share-loading-state","fluid-share-panel-view","url","flutil","url-helper","signin-helper","handlebars-helpers"],optionalRequires:["fluid"],langBundles:["share-modal","common"]});YUI.add("fluid-share-album-view",function(e,t){var a=require("hermes-core/flog")(t);e.namespace("Views").FluidShareAlbumView=e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.albumId=e.albumId,this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-album-icon",sharingDisabled:!0,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_ALBUM"})}),this.constructor.superclass.initializer.call(this,e)},loadState:function(){return e.Promise.resolve()},getItemCount:function(){return this.loadRequiredModels()},loadRequiredModels:function(){var t=this;return e.Promise.all([this.appContext.getModel("set-models",this.albumId+"-1",{filter:1,perPage:5,page:1}),this.appContext.getModel("album-privacy-models",this.albumId),this.appContext.getModel("set-models",this.albumId)]).then(function(e){t.set("albumModel",e[0]),t.set("privacyModel",e[1]),t.isDisabled=0===e[0].getValue("canShare"),t.set("photos",e[0].getValue("photoPageList").getList()),t.set("fullAlbum",e[2]),e[2].on("valuesChanged",function(e){var a={};e&&(Object.keys(e).forEach(function(l){var r=e[l];r.id===t.albumId&&(a[l]=r.newVal)}),Object.keys(a).length>0&&t.get("albumModel").setValues(a))})},function(e){a.error("failed to get models",{err:e})})},buildContainer:function(){return this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-album-icon",sharingDisabled:this.isDisabled,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_ALBUM"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("albumModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("fullAlbum");return{url:e.URLHelper.getShortAlbumURL(t.getValue("normalizedId")),title:t.getValue("title")}},prepareTumblrShareParameters:function(){var e=this.get("fullAlbum");return{title:e.getValue("title"),authorURL:e.getValue("owner").getValue("url"),ownerName:e.getValue("owner").getValue("displayname"),description:e.getValue("description"),displayPhotoURL:this.get("photos").map(function(e){return e.getLargestSize().url}),url:e.getValue("url"),tags:"Flickr"}},preparePinterestShareParameters:function(){var t=this.get("fullAlbum");return{title:t.getValue("title"),description:t.getValue("description"),displayPhotoURL:this.get("photos").length>0?this.get("photos")[0].getLargestSize().url:null,shortURL:e.URLHelper.getShortAlbumURL(t.getValue("normalizedId")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("fullAlbum");return{modelName:"set",modelId:this.albumId,modelOwnerId:e.getValue("owner").id,title:e.getValue("title"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t,a,l,r=this.get("albumModel"),i=this.get("fullAlbum"),s=!1;if(t=this.intlMessage({intlName:"share-modal.ALBUM_PRIVACY_WARNING",photoCount:i.getValue("totalCount")}),this.appContext.flipper.isFlipped("enable-album-download")&&i.getValue("owner").getValue("isMe")){switch(s=!0,this.appContext.getViewer().prefs.downloadAccessPref){case 4:l="ALBUM_DOWNLOAD_ACCESS_YOU";break;case 3:l="ALBUM_DOWNLOAD_ACCESS_FF";break;case 2:l="ALBUM_DOWNLOAD_ACCESS_FOLLOWING";break;case 1:l="ALBUM_DOWNLOAD_ACCESS_MEMBERS";break;case 0:l="ALBUM_DOWNLOAD_ACCESS_EVERYONE"}l&&(a=this.intlMessage({intlName:"share-modal."+l,photoCount:i.getValue("totalCount")}))}return{sizes:r.getValue("primaryPhotoSizes"),url:i.getValue("url"),title:i.getValue("title"),author:i.getValue("owner").getValue("displayname"),authorURL:i.getValue("owner").getValue("url"),albumId:r.getValue("normalizedId"),shortURL:e.URLHelper.getShortAlbumURL(i.getValue("normalizedId")||i.getValue("id")),supportsEmbedr:2===i.getValue("canShare")&&this.appContext.flipper.isFlipped("enable-embedr-in-share")&&this.appContext.flipper.isFlipped("enable-embedr-in-albums"),supportsBBCode:!1,privacyWarningString:t,showDownloadWarning:s,downloadAccessString:a}},getTitleIntlKey:function(){return"SHARE_ALBUM_TO"},getGuestPassParams:function(){var e=this.get("privacyModel"),t=this.get("fullAlbum").getValue("owner").getValue("isMe"),a=e.getValue("countPhotosPublic"),l=e.getValue("countPhotosFriendFamily"),r=e.getValue("countPhotosFriend"),i=e.getValue("countPhotosFamily"),s=this.get("privacyModel").getValue("totalCount")-a,u=t&&l>0&&l!==a,o=t&&r>0&&r!==a,n=t&&i>0&&i!==a,d=!1;return u&&r===l&&(o=!1),u&&i===l&&(n=!1),(s>0||u||n||o)&&(d=!0),{type:"set",id:this.get("albumModel").getValue("normalizedId"),contentMarkedFriends:o,contentMarkedFamily:n,contentMarkedFriendFamily:u,contentMarkedPublic:a,canSharePrivate:d&&t,showGuestPassDropdown:t&&a!==this.get("fullAlbum").getValue("totalCount"),multipleItems:!0}},getIsMine:function(){return this.get("albumModel").getValue("isOwner")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper"],langBundles:[]});YUI.add("hermes-template-album-list-toolbar",function(a,e){var l=a.Template.Handlebars.revive({1:function(a,e,l,s,n){var t,i=null!=e?e:{},r=l.helperMissing,c=a.escapeExpression;return'\t\t<a class="create-album" href="/photos/organize/?start_tab=new_set"><i></i><span>'+c((l.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"album-page.NEW_ALBUM"},data:n}))+'</span></a>\n\t\t<div class="divider"></div>\n\t\t<a class="create-collection" href="/photos/organize/?start_tab=sets"><i></i><span>'+c((l.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"album-page.NEW_COLLECTION"},data:n}))+'</span></a>\n\t\t<a class="view-collections" href="'+c(a.lambda(null!=(t=null!=e?e.urls:e)?t.collections:t,e))+'"><span>'+c((l.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"album-page.VIEW_MY_COLLECTIONS"},data:n}))+"</span></a>\n"},3:function(a,e,l,s,n){var t,i=a.escapeExpression;return'\t\t<a class="view-collections" href="'+i(a.lambda(null!=(t=null!=e?e.urls:e)?t.collections:t,e))+'"><span>'+i((l.intlMessage||e&&e.intlMessage||l.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"album-page.VIEW_COLLECTIONS"},data:n}))+"</span></a>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,l,s,n){var t;return'<div class="album-toolbar-content">\n'+(null!=(t=l.if.call(null!=e?e:{},null!=e?e.isViewingSelf:e,{name:"if",hash:{},fn:a.program(1,n,0),inverse:a.program(3,n,0),data:n}))?t:"")+"</div>\n"},useData:!0}),s={};a.Array.each([],function(e){var l=a.Template.get("hermes/"+e);l&&(s[e]=l)}),a.Template.register("hermes/album-list-toolbar",function(e,n){return n=n||{},n.partials=n.partials?a.merge(s,n.partials):s,l(e,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("album-list-toolbar-view",function(i){i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{},initializer:function(i){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.nsid=i.nsid,this},loadState:function(){return this.appContext.getModel("person-models",this.nsid).then(function(i){this.set("person",i),this.set("isViewingSelf",this.nsid===this.appContext.getViewer().nsid)}.bind(this),function(i){})},buildContainer:function(){var t=this.get("person")&&i.URLHelper.generatePersonUrls(this.get("person"));return this.setContainerWithTemplate("album-list-toolbar",{urls:t,isViewingSelf:this.get("isViewingSelf")}),this},buildErrorContainer:function(){},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","url-helper","hermes-template-album-list-toolbar"],optional:[],langBundles:["album-page","common"]});YUI.add("hermes-template-head-meta",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,t,r){return'name="'},3:function(e,a,n,t,r){return'property="'},5:function(e,a,n,t,r){return'description="'+e.escapeExpression(e.lambda(a,a))+'"'},compiler:[7,">= 4.0.0"],main:function(e,a,n,t,r){var l,i,m,s=null!=a?a:{},o=n.helperMissing,p=e.escapeExpression,u="<meta "+(null!=(l=n.if.call(s,null!=a?a.isName:a,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r}))?l:"")+p("function"==typeof(i=null!=(i=n.metaName||(null!=a?a.metaName:a))?i:o)?i.call(s,{name:"metaName",hash:{},data:r}):i)+'" content="'+p((n.renderMetaInfo||a&&a.renderMetaInfo||o).call(s,null!=a?a.metaValue:a,{name:"renderMetaInfo",hash:{},data:r}))+'" ';return i=null!=(i=n.metaDescription||(null!=a?a.metaDescription:a))?i:o,m={name:"metaDescription",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r},l="function"==typeof i?i.call(s,m):i,n.metaDescription||(l=n.blockHelperMissing.call(a,l,m)),null!=l&&(u+=l),u+' data-dynamic="true">\n'},useData:!0}),t={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(t[a]=n)}),e.Template.register("hermes/head-meta",function(a,r){return r=r||{},r.partials=r.partials?e.merge(t,r.partials):t,n(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("albums-list-page-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("albums-list-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.isOwner=e.isOwner,this.withSetId=e.withSetId,this.pageParams=e.pageParams,e.modelRegistryName="sets-models",e.isViewingSelf=!!this.appContext.getViewer().signedIn&&this.nsid===this.appContext.getViewer().nsid,e.photoListConfig={modelParams:{registryName:"sets-models",modelIdOrAttributes:e.nsid,collectionAttributeName:"albumsList"},interactionViewName:"photo-list-album-interaction-view",engagementModelName:"set-models",viewBeaconRestrictedAttribute:"primaryNeedsInterstitial",parentName:this.name,pageParams:e.pageParams,viewBeaconAttribute:"primary",measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:e.withSetId},e.photoListConfig.layout={targetRowHeight:240,forceAspectRatio:1,containerPadding:{top:8,right:0,bottom:8,left:0},itemSpacing:{horizontal:32,vertical:32}},this.isMobile&&(e.photoListConfig.layout.targetRowHeight=200,e.photoListConfig.layout.containerPadding.right=16,e.photoListConfig.layout.containerPadding.left=16,e.photoListConfig.layout.itemSpacing.horizontal=16,e.photoListConfig.layout.itemSpacing.vertical=16),e.subnavConfig={selected:"albums"},this.doOffline=!!this.appContext.flipper.isFlipped("enable-offline-downloadr"),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"fluid-photostream-coverphoto-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-list-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["fluid-centered"]},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("sets-models",this.nsid),this.appContext.getModel("person-models",this.nsid)]).then(function(e){t.set("albumsListModel",e[0]),t.set("totalItems",e[0].getValue("totalItems")),t.set("owner",e[1])})},buildContainer:function(){var e,t,i=this.get("totalItems");return t=this.pageParams.page>1||i>Math.abs((this.pageParams.viewPageSize||20)*(this.pageParams.page||1)),e=i>0,this.setContainerWithTemplate("albums-list-page",{"fluid-header":this.subviews["fluid-photostream-coverphoto-view"]?this.subviews["fluid-photostream-coverphoto-view"].get("container"):"","album-list-toolbar-view":e?this.subviews["album-list-toolbar-view"].get("container"):"",showPagination:t,isEmpty:0===this.get("totalItems").length,isViewingSelf:this.nsid===this.appContext.getViewer().nsid}),this},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),e+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),e+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",e):(this.set("headContainer",this.subviews["pagination-view"].get("headContainer")),this.updateHead())},showErrorModal:function(t){new e.Views.FluidModal({appContext:this.appContext,darkOverlay:!0,dismissOnOverlayClick:!0,showCancelButton:!1,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),title:this.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),message:t}).show()},showBalls:function(){this.balls||(this.balls=e.Node.create('<div class="loading-balls"></div>'),this.balls.setHTML(this.templates("flickr-balls")({}))),this.get("container").append(this.balls)},hideBalls:function(){this.balls.remove()},downloadAlbum:function(t){var i,o,a,s=this,n=!!this.appContext.flipper.isFlipped("enable-offline-downloadr");if(e.rapidTracker.beacon(this.name,"openDownloadAlbum"),(a=e.Array.find(this.get("albumsListModel").getOwnedModels(),function(e){return e.id===t}))&&this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===a.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),n){if(1===a.getValue("totalCount"))return a.getValue("photoPageList").getPage({page:1,perPage:1}).then(function(t){var i,o,a,n=t[0];n.getValue("isVideo")&&!s.appContext.flipper.isFlipped("disable-video-playback")?o="/video_download.gne?id="+n.id:(i=(a=n.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),0===(o=a.join(".")+"_d."+i).indexOf("//")&&(o="https:"+o)),e.config.doc.location.href=o});if(a.getValue("totalCount")>e.config.flickr.downloadr.max_album_items)return e.rapidTracker.beacon(this.name,"albumListDownloadTooMany"),this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:a.getValue("owner").getValue("displayname"),userurl:a.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+a.id}),this.intlMessage({intlName:"downloadr.TOO_MANY_TITLE"}),!0);o=s.bulkDownloaderView.createTitle(a.getValue("photoCount"),a.getValue("videoCount")),s.bulkDownloaderView.showDownloadDialog({doOffline:!0,title:o,setID:t})}else i=this.bulkDownloaderView.showLoadingDialog(),this.bulkDownloaderView.prepareArchive({set_id:t}).then(function(e){i.close(),s.bulkDownloaderView.showDownloadDialog(e)}).catch(function(e){i.close(),s.bulkDownloaderView.onError(e)})},shareAlbum:function(t,i){var o=new e.Views.FluidShareAlbumView({appContext:this.appContext,albumId:t});this.showBalls(),e.rapidTracker.beacon(this.name,"openShareAlbum"),o.on("sharePresentationClose",o.destroy.bind(o)),o.initialize().then(function(){this.prepareModal(i)}.bind(o)).then(function(){this.hideBalls()}.bind(this)).catch(function(e){this.hideBalls()}.bind(this))},deleteAlbum:function(t){var o=this;return e.rapidTracker.beacon(this.name,"deleteAlbum"),this.showBalls(),this.confirmAlbumDelete(t).then(function(){return o.appContext.getModel("set-models",t).then(function(i){var a=[];return i.toJSON().photoPageList.forEach(function(e){a.push(o.appContext.getModel("photo-sets-models",e.id).then(function(e){e.getValue("sets").removeFromList(t)}))}),a.push(i.registry.remoteDelete(t).then(function(){o.get("albumsListModel").getValue("albumsList").remove(t),o.appContext.flapp.navigate(e.config.doc.location.href)})),e.Promise.all(a)})}).catch(function(e){i.error("Error deleting album",{err:e}),o.hideBalls()})},confirmAlbumDelete:function(t){var i=this;return e.rapidTracker.beacon(this.name,"deleteConfirm"),new e.Promise(function(t,o){var a=new e.Views.FluidModal({appContext:i.appContext,title:i.intlMessage({intlName:"common.CONFIRMATION"}),message:i.intlMessage({intlName:"album-page.CONFIRM_ALBUM_DELETE_NO_CONTENTS_DELETED"})});i.registerEventHandler(a.on("actionClick",function(){t()})),i.registerEventHandler(a.on("cancelClick",function(){e.rapidTracker.beacon(i.name,"cancelDeleteConfirm"),o()})),a.show()})},handleClick:function(e){var t,i=e.target;i.hasClass("cta")&&(e.halt(),t=i.ancestor(".photo-list-album-interaction").getData("albumId"),i.hasClass("is-disabled")||(i.hasClass("share")?this.shareAlbum(t,i):i.hasClass("book")?this.appContext.flapp.navigate("/create"):i.hasClass("download")?this.downloadAlbum(t):i.hasClass("trash")&&this.deleteAlbum(t)))},destructor:function(){this.balls&&this.balls.inDoc()&&this.balls.remove(),this.balls=null,this.bulkDownloaderView&&this.bulkDownloaderView.destroy()},activate:function(){return this.registerEventHandler(this.get("container").on("click",this.handleClick,this)),this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext,doOffline:this.doOffline}),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.handlePageResize.bind(this))),this},handlePageResize:function(){e.config.win.innerWidth<=700?this.hasBeenMobilized||(this.hasBeenMobilized=!0,this.subviews["photo-list-view"].photoListLayout.targetRowHeight=200,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=16,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=16):(this.hasBeenMobilized&&(this.subviews["photo-list-view"].photoListLayout.targetRowHeight=240,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=0,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=0,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=32,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=32),this.hasBeenMobilized=!1)},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,vwrOwner:this.isOwner?1:0}},onError:function(t,i,o){var a;return a={appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),darkOverlay:!0},a[o?"htmlMessage":"message"]=t,this.errorDialog=new e.Views.FluidModal(a),this.errorDialog.show(),this.errorDialog}},{ATTRS:{spaceid:{value:792600578}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-albums-list-page","global-nav-view","footer-full-view","pagination-view","fluid-photostream-coverphoto-view","fluid-share-album-view","hermes-template-flickr-balls","album-list-toolbar-view","hermes-template-head-link","hermes-template-head-meta"],optionalRequires:["bulk-downloader-view"],optional:["sets-models"],langBundles:["album-page","common","downloadr","magic-empty-states","meta"]});YUI.add("person-contacts-count-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-people-contacts-getInfo"].run(e,this.appContext)}},attributes:{followerCount:{defaultFn:function(){return 0}},followingCount:{defaultFn:function(){return 0}},pathAlias:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-contacts-getInfo-fetcher","attribute-helpers"]});YUI.add("flickr-people-contacts-getInfo-fetcher",function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-people-contacts-getInfo"]={run:function(r,s){var o=this;return new e.FlickrPromise({apiResponse:s.callAPI("flickr.people.getInfo",this._processParams(r)),personContactsModelRegistry:s.getModelRegistry("person-contacts-count-models")}).then(function(e){return o._processResponse(e,r)},e.FetcherErrorLogger(t))},_processParams:function(e){var t={datecreate:1,extras:"rev_contacts, contacts"};if(e.extras&&"string"==typeof e.extras&&e.extras.length>0&&(t.extras=t.extras+","+e.extras),e.id)t.user_id=e.id;else{if(!e.pathAlias)throw new Error("`fetch` is missing required params.");t.url=e.pathAlias}return t},_processResponse:function(e){var t=e.apiResponse,r=e.personContactsModelRegistry,s=t.person,o=s.id;return r.addOrUpdate({id:o,followerCount:s.revContacts&&parseInt(s.revContacts._content,10),followingCount:parseInt(s.contacts,10),pathAlias:s.pathAlias}),s}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-contacts-count-models","api-helper"]});